on:
    push:
        branches:
            - development
        paths:
            - '**.json'

jobs:
    sync-readme:
        runs-on: docker
        container:
            image: lbausch/laravel-ci:php83
        steps:
            - uses: actions/checkout@v4
              with:
                  ref: ${{ github.ref }}
                  ssh-key: ${{ secrets.ACTIONS_PRIVATE_KEY }}
                  ssh-known-hosts: ${{ vars.ENHOSTCODE_KNOWN_HOSTS }}
            - run: composer install
            - run: php adventofcode sync-readme
            - run: |
                  git config user.name "Zachary Claret-Scott [Bot]"
                  git config user.email "zachary.claretscott@gmail.com"
                  git add .
                  git commit -m "Updated readme" || exit 0
                  git push
    sync-gitea-issues:
        runs-on: docker
        container:
            image: lbausch/laravel-ci:php83
        steps:
            - uses: actions/checkout@v4
              with:
                ref: ${{ github.ref }}
                ssh-key: ${{ secrets.ACTIONS_PRIVATE_KEY }}
                ssh-known-hosts: ${{ vars.ENHOSTCODE_KNOWN_HOSTS }}
            - run: composer install
            - run: cp .env.example .env
            - run: sed -i '/^ISSUES_GITEA_HOST=/c\export ISSUES_GITEA_HOST=${{ vars.ENHOSTCODE_ENDPOINT }}' .env
            - run: sed -i '/^ISSUES_GITEA_TOKEN=/c\export ISSUES_GITEA_TOKEN=${{ secrets.ISSUES_GITEA_TOKEN }}' .env
            - run: sed -i '/^ISSUES_GITEA_USER=/c\export ISSUES_GITEA_USER=${{ vars.ISSUES_GITEA_USER }}' .env
            - run: sed -i '/^ISSUES_GITEA_REPO=/c\export ISSUES_GITEA_REPO=${{ vars.ISSUES_GITEA_REPO }}' .env
            - run: php adventofcode sync-gitea-issues
            - run: |
               git config user.name "Zachary Claret-Scott [Bot]"
               git config user.email "zachary.claretscpott@gmail.com"
               git add .
               git commit -m "Updated any gitea issues IDs" || exit 0
               git push
